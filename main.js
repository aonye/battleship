(()=>{"use strict";const e=(e,t)=>({name:e,length:t,hits:new Array(t),hit(e){this.hits[e]||(this.hits[e]="X")},isSunk(){for(let e=0;e<this.hits.length;e++)if(void 0===this.hits[e])return!1;return!0}}),t=()=>{const t=function(){let e=new Array(100);for(let t=0;t<e.length;t++)e[t]={containShip:!1,hasBeenHit:!1};return e}(),n=[];let r=!1;function o(){switch(n.length){case 0:return{length:5,name:"Carrier"};case 1:return{length:4,name:"Battleship"};case 2:return{length:3,name:"Cruiser"};case 3:return{length:3,name:"Submarine"};case 4:return{length:2,name:"Destroyer"};default:console.log("this should never be printed")}}return{placeShip:function(a){const{name:i,length:l}=o(),c=e(i,l);a=parseFloat(a);for(let e=0;e<l;e++)if(!0===r){let n=10*e;t[a+n].containShip=!0,t[a+n].shipName=i,t[a+n].position=e}else t[a+e].containShip=!0,t[a+e].shipName=i,t[a+e].position=e;n.push(c)},toggleVertical:function(){r=!0!==r},verticalStatus:function(){return r},getNumOfShips:function(){return n.length},getShipInfo:o,receiveAttack:function(e){if(!1===t[e].hasBeenHit){if(t[e].hasBeenHit=!0,!0===t[e].containShip){const o=(r=t[e].shipName,n.filter((e=>e.name===r))[0]);return o.hit(t[e].position),{ship:o,result:!0}}return{ship:void 0,result:!1}}var r},isAllSunk:function(){for(let e=0;e<n.length;e++)if(!1===n[e].isSunk())return!1;return!0},board:t,ships:n}},n=(e,t)=>{function n(e){return!0!==e.hasBeenHit}function r(e){const n=parseFloat(e),{length:r}=t.getShipInfo();if(t.verticalStatus()){for(let e=0;e<r;e++){const r=10*e+n;if(r>t.board.length-1)return!0===o()&&(alert("Error, out of bounds."),!1);if(!0===t.board[r].containShip)return!0===o()&&(alert("Error, ship in path."),!1)}return!0}{let e=(a=n,parseFloat(Math.trunc(a/10)+"9"));for(let a=0;a<r;a++){if(n+a>e)return!0===o()&&(alert("Error, cannot wrap ship."),!1);if(!0===t.board[n+a].containShip)return!0===o()&&(alert("Error, ship in path."),!1)}return!0}var a}function o(){return"Computer"!==e}return"Computer"===e?{name:e,boardInfo:t,checkMove:n,generateMove:function(){return Math.floor(99*Math.random())},checkShipPlacement:r}:{name:e,boardInfo:t,checkMove:n,checkShipPlacement:r}},r=(()=>{const e=document.querySelector(".container"),t=document.querySelector("#bulletin");return{resetDOM:function(){for(;e.hasChildNodes();)e.removeChild(e.lastChild)},updateShips:function(e,t){for(let n=0;n<t.length;n++)!0===t[n].containShip&&(document.querySelector(`#${e+n}`).style.backgroundColor="rgb(235, 199, 235)")},updateBoardResult:function(e,t){!1===t?(e.textContent="X",e.classList.add("miss")):(e.textContent="O",e.classList.add("hit"))},renderBoard:function(t){let n=document.createElement("div");n.classList="board",n.setAttribute("id",t);for(let e=0;e<=99;e++){let r=document.createElement("div");r.setAttribute("id",`${t+e}`),n.appendChild(r)}e.append(n)},shipDestroyed:function(e,t,n){for(let r=0;r<n.length;r++)if(n[r].shipName===e){const e=document.querySelector(`#${t+r}`);e.style.transition="background-color 0.75s ease",e.style.backgroundColor="rgb(40, 40, 40)"}},changeBulletMsg:function(e){t.textContent=e},toggleVerticalBtn:function(e){"Vertical"===e.textContent?e.textContent="Horizontal":e.textContent="Vertical"},toggleNode:function(e){"none"===e.style.display?e.style.display="flex":e.style.display="none"},fadeInNode:function(e){e.style.transition="opacity 0.5s ease-in",e.style.opacity="1"},fadeOutNode:function(e){e.style.transition="opacity, 0.5s ease-out",e.style.opacity="0"}}})();(()=>{const e=document.getElementById("form"),o=document.querySelector("#name"),a=document.querySelector("#name + button"),i=document.querySelector("#vertical"),l=document.querySelector("#newgame"),c={};function u(e){c.player=n(e,t()),c.cpu=n("Computer",t()),c.currentPlayer=0===Math.floor(2*Math.random())?"player":"cpu",r.renderBoard(c.player.name),r.renderBoard(c.cpu.name),console.log(c),s()}function s(){if(5===c.player.boardInfo.getNumOfShips()&&5===c.cpu.boardInfo.getNumOfShips())return r.changeBulletMsg("Finished ship placing phase"),r.toggleNode(i),void setTimeout((()=>{f()}),2e3);!function(){const e=d(),t=document.querySelectorAll(`#${d().name} div`),{name:n,length:o}=d().boardInfo.getShipInfo();function a(n){const o=m(n.target.id);e.checkShipPlacement(o)&&(e.boardInfo.placeShip(o),t.forEach((e=>{e.removeEventListener("click",a)})),r.updateShips(d().name,e.boardInfo.board),p(),s())}"Computer"!==d().name?(r.changeBulletMsg(`Please select node to place ship: ${n}(${o}).`),t.forEach((e=>{e.addEventListener("click",a)}))):(r.changeBulletMsg(`Computer is placing ship: ${n}(${o}).`),setTimeout((()=>{!function(){let t;do{Math.floor(2*Math.random())&&e.boardInfo.toggleVertical(),t=e.generateMove()}while(!e.checkShipPlacement(t));e.boardInfo.placeShip(t),p(),s()}()}),1500))}()}function d(){return c[`${c.currentPlayer}`]}function h(){return"player"===c.currentPlayer?c.cpu:c.player}function p(){"Computer"!==d().name?c.currentPlayer="cpu":c.currentPlayer="player"}function f(){if(c.player.boardInfo.isAllSunk())return r.changeBulletMsg(`${c.cpu.name} is the winner!`),void r.toggleNode(l);if(c.cpu.boardInfo.isAllSunk())return r.changeBulletMsg(`${c.player.name} is the winner!`),void r.toggleNode(l);switch(c.currentPlayer){case"player":r.changeBulletMsg("Your turn to attack!"),function(){const e=document.querySelectorAll(`#${h().name} div`);function t(n){const r=m(n.target.id),o=h(),a=o.boardInfo.board;if(o.checkMove(a[r]))return e.forEach((e=>e.removeEventListener("click",t))),void g(n.target,r);alert("Cannot select this node, please try again")}e.forEach((e=>{e.addEventListener("click",t)}))}();break;case"cpu":r.changeBulletMsg("Enemy fire!"),setTimeout((()=>{!function(){let e;const t=h(),n=t.boardInfo.board;do{e=c.cpu.generateMove()}while(!t.checkMove(n[e]));g(document.querySelector(`#${h().name} div[id='${h().name+e}']`),e)}()}),1e3)}}function g(e,t){const{ship:n,result:o}=h().boardInfo.receiveAttack(t);if(o&&n.isSunk()){const{name:t,boardInfo:a}=h();return r.changeBulletMsg(`${c.currentPlayer} has sunk ${n.name}(${n.length}).`),r.updateBoardResult(e,o),r.shipDestroyed(n.name,t,a.board),void setTimeout((()=>{p(),f()}),2e3)}r.updateBoardResult(e,o),p(),f()}function m(e){return e.match(/\d+/gm)[0]}setTimeout((()=>{r.changeBulletMsg("Player, please enter your name below: "),r.fadeInNode(e)}),1e3),a.addEventListener("click",(function(t){t.preventDefault();const n=o.value;if(o.value="",n){if("Computer"===n)return r.changeBulletMsg("You cannot be a 'Computer' Beep Boop."),void setTimeout((()=>{r.changeBulletMsg("Player, please enter your name below: ")}),2e3);if(n.length>15)return r.changeBulletMsg("Name is too long (must be <15 chars). Try again."),void setTimeout((()=>{r.changeBulletMsg("Player, please enter your name below: ")}),2e3);r.changeBulletMsg(`Welcome aboard, ${n}. Making grid..`),setTimeout((()=>{r.toggleNode(e),r.toggleNode(i),u(`${n}`)}),2e3)}})),i.addEventListener("click",(function(e){r.toggleVerticalBtn(e.target),c.player.boardInfo.toggleVertical()})),l.addEventListener("click",(function(){r.toggleNode(l),r.resetDOM(),u(c.player.name)}))})()})();
(()=>{"use strict";const e=(e,t)=>({name:e,length:t,hits:new Array(t),hit(e){this.hits[e]||(this.hits[e]="X")},isSunk(){for(let e=0;e<this.hits.length;e++)if(void 0===this.hits[e])return!1;return!0}}),t=()=>{const t=function(){let e=new Array(100);for(let t=0;t<e.length;t++)e[t]={containShip:!1,hasBeenHit:!1};return e}(),n=[];let r=!1;function o(e){return n.filter((t=>t.name===e))[0]}function i(){switch(n.length){case 0:return{length:5,shipName:"Carrier"};case 1:return{length:4,shipName:"Battleship"};case 2:return{length:3,shipName:"Cruiser"};case 3:return{length:3,shipName:"Submarine"};case 4:return{length:2,shipName:"Destroyer"};default:console.log("this should never be printed")}}return{board:t,checkShipPlacement:function(e,n){const o=parseFloat(n),{length:a}=i();if(r){for(let n=0;n<a;n++){const r=10*n+o;if(r>t.length-1)return"Computer"!==e&&(alert("Error, out of bounds."),!1);if(!0===t[r].containShip)return"Computer"!==e&&(alert("Error, ship in path."),!1)}return!0}{const n=(l=o,parseFloat(Math.trunc(l/10)+"9"));for(let r=0;r<a;r++){if(o+r>n)return"Computer"!==e&&(alert("Error, cannot wrap ship."),!1);if(!0===t[o+r].containShip)return"Computer"!==e&&(alert("Error, ship in path."),!1)}return!0}var l},placeShip:function(o){const{shipName:a,length:l}=i(),c=e(a,l);o=parseFloat(o);const u=[];for(let e=0;e<l;e++)if(!0===r){let n=10*e;t[o+n].containShip=!0,t[o+n].shipName=a,t[o+n].position=e,u.push(o+n)}else t[o+e].containShip=!0,t[o+e].shipName=a,t[o+e].position=e,u.push(o+e);return n.push(c),u},toggleVertical:function(){r=!0!==r},getNumOfShips:function(){return n.length},getShip:o,getShipInfo:i,receiveAttack:function(e){if(t[e].hasBeenHit=!0,!0===t[e].containShip){const n=o(t[e].shipName);return n.hit(t[e].position),{ship:n,result:!0}}return{ship:void 0,result:!1}},isAllSunk:function(){for(let e=0;e<n.length;e++)if(!1===n[e].isSunk())return!1;return!0}}},n=e=>{function t(e){return!0!==e.hasBeenHit}return"Computer"===e?{name:e,checkMove:t,generateMove:function(){return Math.floor(99*Math.random())}}:{name:e,checkMove:t}},r=(()=>{const e=document.querySelector(".container"),t=document.querySelector("#bulletin");return{resetDOM:function(){for(;e.hasChildNodes();)e.removeChild(e.lastChild)},highlightShips:function(e,t){for(let n=0;n<t.length;n++)document.querySelector(`#${e+t[n]}`).style.backgroundColor="rgb(235, 199, 235)"},updateBoardResult:function(e,t){!1===t?(e.textContent="X",e.classList.add("miss")):(e.textContent="O",e.classList.add("hit"))},renderBoard:function(t){let n=document.createElement("div");n.classList="board",n.setAttribute("id",t);for(let e=0;e<=99;e++){let r=document.createElement("div");r.setAttribute("id",`${t+e}`),n.appendChild(r)}e.append(n)},shipDestroyed:function(e,t,n){for(let r=0;r<n.length;r++)if(n[r].shipName===e){const e=document.querySelector(`#${t+r}`);e.style.transition="background-color 0.75s ease",e.style.backgroundColor="rgb(40, 40, 40)"}},changeBulletMsg:function(e){t.textContent=e},toggleVerticalBtn:function(e){"Vertical"===e.textContent?e.textContent="Horizontal":e.textContent="Vertical"},toggleNode:function(e){"none"===e.style.display?e.style.display="flex":e.style.display="none"},fadeInNode:function(e){e.style.transition="opacity 0.5s ease-in",e.style.opacity="1"},fadeOutNode:function(e){e.style.transition="opacity, 0.5s ease-out",e.style.opacity="0"}}})();(()=>{const e=document.getElementById("form"),o=document.querySelector("#name"),i=document.querySelector("#name + button"),a=document.querySelector("#vertical"),l=document.querySelector("#newgame"),c={};function u(e){c.player=n(e),c.playerBoardInfo=t(),c.cpu=n("Computer"),c.cpuBoardInfo=t(),!0===c.winner?g():c.currentPlayer=0===Math.floor(2*Math.random())?"player":"cpu",r.renderBoard(c.player.name),r.renderBoard(c.cpu.name),s()}function s(){if(5===c.playerBoardInfo.getNumOfShips()&&5===c.cpuBoardInfo.getNumOfShips())return r.changeBulletMsg("Finished ship placing phase"),r.toggleNode(a),void setTimeout((()=>{f()}),2e3);!function(){const e=h(),t=c[`${c.currentPlayer}BoardInfo`],{shipName:n,length:o}=t.getShipInfo(),i=document.querySelectorAll(`#${e.name} div`);function a(n){const o=m(n.target.id);if(t.checkShipPlacement(e.name,o)){const n=t.placeShip(o);r.highlightShips(e.name,n),i.forEach((e=>{e.removeEventListener("click",a)})),g(),s()}}"Computer"!==e.name?(r.changeBulletMsg(`Please select node to place ship: ${n} (${o}).`),i.forEach((e=>{e.addEventListener("click",a)}))):(r.changeBulletMsg(`Computer is placing ship: ${n} (${o}).`),setTimeout((()=>{!function(){let n;do{Math.floor(2*Math.random())&&t.toggleVertical(),n=e.generateMove()}while(!t.checkShipPlacement(e.name,n));const o=t.placeShip(n);r.highlightShips(h().name,o),g(),s()}()}),1500))}()}function h(){return c[`${c.currentPlayer}`]}function p(){return"player"===c.currentPlayer?c.cpu:c.player}function d(){return"player"===c.currentPlayer?c.cpuBoardInfo:c.playerBoardInfo}function g(){"Computer"!==h().name?c.currentPlayer="cpu":c.currentPlayer="player"}function f(){return c.playerBoardInfo.isAllSunk()?(r.changeBulletMsg(`${c.cpu.name} is the winner!`),void r.toggleNode(l)):c.cpuBoardInfo.isAllSunk()?(r.changeBulletMsg(`${c.player.name} is the winner!`),void r.toggleNode(l)):void function(){let e;const t=p(),n=d().board,o=document.querySelectorAll(`#${p().name} div`);switch(c.currentPlayer){case"player":r.changeBulletMsg("Your turn to attack!"),o.forEach((e=>{e.addEventListener("click",i)}));break;case"cpu":r.changeBulletMsg("Enemy fire!"),setTimeout((()=>{!function(){do{e=c.cpu.generateMove()}while(!t.checkMove(n[e]));a(document.querySelector(`#${p().name} div[id = '${p().name+e}']`),e)}()}),1e3)}function i(r){if(e=m(r.target.id),t.checkMove(n[e]))return o.forEach((e=>e.removeEventListener("click",i))),void a(r.target,e);alert("Cannot select this node, please try again")}function a(e,t){const{ship:n,result:o}=d().receiveAttack(t);if(o&&n.isSunk())return r.changeBulletMsg(`${p.name} has sunk ${n.name} (${n.length}).`),r.updateBoardResult(e,o),r.shipDestroyed(n.name,p().name,d().board),void setTimeout((()=>{g(),f()}),2e3);r.updateBoardResult(e,o),g(),f()}}()}function m(e){return e.match(/\d+/gm)[0]}setTimeout((()=>{r.changeBulletMsg("Player, please enter your name below: "),r.fadeInNode(e)}),2e3),i.addEventListener("click",(function(t){t.preventDefault();const n=o.value;if(o.value="",n){if("Computer"===n)return r.changeBulletMsg("You cannot be a 'Computer' Beep Boop."),void setTimeout((()=>{r.changeBulletMsg("Player, please enter your name below: ")}),2e3);if(n.length>15)return r.changeBulletMsg("Name is too long(must be < 15 chars).Try again."),void setTimeout((()=>{r.changeBulletMsg("Player, please enter your name below: ")}),2e3);r.changeBulletMsg(`Welcome aboard, ${n}. Making grid..`),setTimeout((()=>{r.toggleNode(e),r.toggleNode(a),u(`${n}`)}),2e3)}})),a.addEventListener("click",(function(e){r.toggleVerticalBtn(e.target),c.playerBoardInfo.toggleVertical()})),l.addEventListener("click",(function(){r.toggleNode(l),r.resetDOM(),r.toggleNode(a),c.winner=!0,u(c.player.name)}))})()})();
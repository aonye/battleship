(()=>{"use strict";const e=(e,t)=>({name:e,length:t,hits:new Array(t),hit(e){this.hits[e]||(this.hits[e]="X")},isSunk(){for(let e=0;e<this.hits.length;e++)if(void 0===this.hits[e])return!1;return!0}}),t=()=>{const t=function(){let e=new Array(100);for(let t=0;t<e.length;t++)e[t]={containShip:!1,hasBeenHit:!1};return e}(),n=[];let o=!1;function r(){return n.length}function i(e){switch(e){case 0:return{length:5,name:"Carrier"};case 1:return{length:4,name:"Battleship"};case 2:return{length:3,name:"Cruiser"};case 3:return{length:3,name:"Submarine"};case 4:return{length:2,name:"Destroyer"};default:console.log("this should never be printed")}}return{placeShip:function(a){const{name:c,length:l}=i(r()),u=e(c,l);a=parseFloat(a);for(let e=0;e<l;e++)if(!0===o){let n=10*e;t[a+n].containShip=!0,t[a+n].shipName=c,t[a+n].position=e}else t[a+e].containShip=!0,t[a+e].shipName=c,t[a+e].position=e;n.push(u)},toggleVertical:function(){o=!0!==o},verticalStatus:function(){return o},getNumOfShips:r,getShipInfo:i,receiveAttack:function(e){if(!1===t[e].hasBeenHit){if(t[e].hasBeenHit=!0,!0===t[e].containShip){const r=(o=t[e].shipName,n.filter((e=>e.name===o))[0]);return r.hit(t[e].position),{ship:r,result:!0}}return{ship:void 0,result:!1}}var o},isAllSunk:function(){for(let e=0;e<n.length;e++)if(!1===n[e].isSunk())return!1;return!0},board:t,ships:n}},n=(e,t)=>{function n(e){return!0!==e.hasBeenHit}function o(e){const n=parseFloat(e),{length:o}=t.getShipInfo(t.getNumOfShips());if(t.verticalStatus()){for(let e=0;e<o;e++){const o=10*e+n;if(o>t.board.length-1)return console.log("out of bounds",o),!1;if(!0===t.board[o].containShip)return console.log("ship in path",o),!1}return!0}{let e=(r=n,parseFloat(Math.trunc(r/10)+"9"));for(let r=0;r<o;r++){if(n+r>e)return console.log("wrap error",n+r),!1;if(!0===t.board[n+r].containShip)return console.log("ship in path",n+r),!1}return!0}var r}return"Computer"===e?{name:e,boardInfo:t,checkMove:n,generateMove:function(){return Math.floor(99*Math.random())},checkShipPlacement:o}:{name:e,boardInfo:t,checkMove:n,checkShipPlacement:o}},o=(()=>{const e=document.querySelector(".bulletin"),t=document.querySelector(".container");return{updateShips:function(e,t){for(let n=0;n<t.length;n++)!0===t[n].containShip&&(document.querySelector(`#${e+n}`).style.backgroundColor="rgb(235, 199, 235)")},updateBoardResult:function(e,t){!1===t?(e.textContent="X",e.classList.add("miss")):(e.textContent="O",e.classList.add("hit"))},renderBoard:function(e){let n=document.createElement("div");n.classList="board",n.setAttribute("id",e);for(let t=0;t<=99;t++){let o=document.createElement("div");o.setAttribute("id",`${e+t}`),n.appendChild(o)}t.append(n)},shipDestroyed:function(e,t){for(let n=0;n<t.length;n++)t[n].shipName===e&&(document.querySelector(`#${e+n}`).style.backgroundColor="rgb(235, 199, 235)")},changeBulletMsg:function(t){e.textContent=t},unhideNode:function(e){console.log(e),e.style.transition="opacity 1s ease-in",e.style.opacity="1"}}})();(()=>{const e=document.getElementById("form"),r=document.querySelector("#name"),i=document.querySelector("#name + button"),a={};function c(){return a[`${a.currentPlayer}`]}function l(){return"player"===a.currentPlayer?a.cpu:a.player}function u(){"Computer"!==c().name?a.currentPlayer="cpu":a.currentPlayer="player"}function s(){if(a.player.boardInfo.isAllSunk())console.log("made it in here");else if(a.cpu.boardInfo.isAllSunk())console.log("cpu has won");else switch(a.currentPlayer){case"player":!function(){const e=document.querySelectorAll(`#${l().name} div`);function t(n){const o=d(n.target.id),r=l(),i=r.boardInfo.board;if(r.checkMove(i[o]))return e.forEach((e=>e.removeEventListener("click",t))),void h(n.target,o);alert("Cannot select this node, please try again")}e.forEach((e=>{e.addEventListener("click",t)}))}();break;case"cpu":setTimeout((()=>{!function(){let e;const t=l(),n=t.boardInfo.board;do{e=a.cpu.generateMove()}while(!t.checkMove(n[e]));h(document.querySelector(`#${l().name} div[id='${l().name+e}']`),e)}()}),2e3)}}function h(e,t){const{ship:n,result:r}=l().boardInfo.receiveAttack(t);r&&n.isSunk()&&console.log("ship sunk"),o.updateBoardResult(e,r),u(),s()}function d(e){return e.match(/\d+/gm)[0]}setTimeout((()=>{o.changeBulletMsg("Player: please enter your name below: "),console.log("lol"),o.unhideNode(e)}),2e3),a.player=n("Anon",t()),a.cpu=n("Computer",t()),a.currentPlayer=0===Math.floor(2*Math.random())?"player":"cpu",o.renderBoard(a.player.name),o.renderBoard(a.cpu.name),console.log(`${c().name} has been randomly chosen to start first`),function e(){if(5===a.player.boardInfo.getNumOfShips()&&5===a.cpu.boardInfo.getNumOfShips())return console.log("finished placing ships"),void s();!function(){const t=c(),n=document.querySelectorAll(`#${c().name} div`);function r(i){const a=d(i.target.id);t.checkShipPlacement(a)&&(t.boardInfo.placeShip(a),n.forEach((e=>{e.removeEventListener("click",r)})),o.updateShips(c().name,t.boardInfo.board),u(),e())}"Computer"!==c().name?n.forEach((e=>{e.addEventListener("click",r)})):function(){let n;do{Math.floor(2*Math.random())&&t.boardInfo.toggleVertical(),n=t.generateMove()}while(!t.checkShipPlacement(n));t.boardInfo.placeShip(n),u(),e()}()}()}(),i.addEventListener("click",(function(e){e.preventDefault(),console.log(r.value),r.value=""}))})()})();
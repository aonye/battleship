(()=>{"use strict";const e=(e,t)=>({name:e,length:t,hits:new Array(t),hit(e){this.hits[e]||(this.hits[e]="X")},isSunk(){for(let e=0;e<this.hits.length;e++)if(void 0===this.hits[e])return!1;return!0}}),t=()=>{const t=function(){let e=new Array(100);for(let t=0;t<e.length;t++)e[t]={containShip:!1,hasBeenHit:!1};return e}(),n=[];let r=!1;function o(){return n.length}function i(e){switch(e){case 0:return{length:5,name:"Carrier"};case 1:return{length:4,name:"Battleship"};case 2:return{length:3,name:"Cruiser"};case 3:return{length:3,name:"Submarine"};case 4:return{length:2,name:"Destroyer"};default:console.log("this should never be printed")}}return{placeShip:function(a){const{name:c,length:l}=i(o()),s=e(c,l);a=parseFloat(a);for(let e=0;e<l;e++)if(!0===r){let n=10*e;t[a+n].containShip=!0,t[a+n].shipName=c,t[a+n].position=e}else t[a+e].containShip=!0,t[a+e].shipName=c,t[a+e].position=e;n.push(s)},toggleVertical:function(){r=!0!==r},verticalStatus:function(){return r},getNumOfShips:o,getShipInfo:i,receiveAttack:function(e){if(!1===t[e].hasBeenHit){if(t[e].hasBeenHit=!0,!0===t[e].containShip){const o=(r=t[e].shipName,n.filter((e=>e.name===r))[0]);return o.hit(t[e].position),{ship:o,result:!0}}return{ship:void 0,result:!1}}var r},isAllSunk:function(){for(let e=0;e<n.length;e++)if(!1===n[e].isSunk())return!1;return!0},board:t,ships:n}},n=(e,t)=>{function n(e){return!0!==e.hasBeenHit}function r(e){const n=parseFloat(e),{length:r}=t.getShipInfo(t.getNumOfShips());if(t.verticalStatus()){for(let e=0;e<r;e++){const r=10*e+n;if(r>t.board.length-1)return console.log("out of bounds",r),!1;if(!0===t.board[r].containShip)return console.log("ship in path",r),!1}return!0}{let e=(o=n,parseFloat(Math.trunc(o/10)+"9"));for(let o=0;o<r;o++){if(n+o>e)return console.log("wrap error",n+o),!1;if(!0===t.board[n+o].containShip)return console.log("ship in path",n+o),!1}return!0}var o}return"Computer"===e?{name:e,boardInfo:t,checkMove:n,generateMove:function(){return Math.floor(99*Math.random())},checkShipPlacement:r}:{name:e,boardInfo:t,checkMove:n,checkShipPlacement:r}},r=(()=>{const e=document.querySelector(".container");return{updateShips:function(e,t){for(let n=0;n<t.length;n++)!0===t[n].containShip&&(document.querySelector(`#${e+n}`).style.backgroundColor="rgb(235, 199, 235)")},updateBoardResult:function(e,t){!1===t?(e.textContent="X",e.classList.add("miss")):(e.textContent="O",e.classList.add("hit"))},renderBoard:function(t){let n=document.createElement("div");n.classList="board",n.setAttribute("id",t);for(let e=0;e<=99;e++){let r=document.createElement("div");r.setAttribute("id",`${t+e}`),n.appendChild(r)}e.append(n)},shipDestroyed:function(e,t){for(let n=0;n<t.length;n++)t[n].shipName===e&&(document.querySelector(`#${e+n}`).style.backgroundColor="rgb(235, 199, 235)")}}})();(()=>{const e={};function o(){return e[`${e.currentPlayer}`]}function i(){return"player"===e.currentPlayer?e.cpu:e.player}function a(){"Computer"!==o().name?e.currentPlayer="cpu":e.currentPlayer="player"}function c(){if(e.player.boardInfo.isAllSunk())console.log("made it in here");else if(e.cpu.boardInfo.isAllSunk())console.log("cpu has won");else switch(e.currentPlayer){case"player":!function(){const e=document.querySelectorAll(`#${i().name} div`);function t(n){const r=s(n.target.id),o=i(),a=o.boardInfo.board;if(o.checkMove(a[r]))return e.forEach((e=>e.removeEventListener("click",t))),void l(n.target,r);alert("Cannot select this node, please try again")}e.forEach((e=>{e.addEventListener("click",t)}))}();break;case"cpu":setTimeout((()=>{!function(){let t;const n=i(),r=n.boardInfo.board;do{t=e.cpu.generateMove()}while(!n.checkMove(r[t]));l(document.querySelector(`#${i().name} div[id='${i().name+t}']`),t)}()}),2e3)}}function l(e,t){const{ship:n,result:o}=i().boardInfo.receiveAttack(t);o&&n.isSunk()&&console.log("ship sunk"),r.updateBoardResult(e,o),a(),c()}function s(e){return e.match(/\d+/gm)[0]}e.player=n("Anon",t()),e.cpu=n("Computer",t()),e.currentPlayer=0===Math.floor(2*Math.random())?"player":"cpu",r.renderBoard(e.player.name),r.renderBoard(e.cpu.name),console.log(`${o().name} has been randomly chosen to start first`),function t(){if(5===e.player.boardInfo.getNumOfShips()&&5===e.cpu.boardInfo.getNumOfShips())return console.log("finished placing ships"),void c();!function(){const e=o(),n=document.querySelectorAll(`#${o().name} div`);function i(c){const l=s(c.target.id);e.checkShipPlacement(l)&&(e.boardInfo.placeShip(l),n.forEach((e=>{e.removeEventListener("click",i)})),r.updateShips(o().name,e.boardInfo.board),a(),t())}"Computer"!==o().name?n.forEach((e=>{e.addEventListener("click",i)})):function(){let n;do{Math.floor(2*Math.random())&&e.boardInfo.toggleVertical(),n=e.generateMove()}while(!e.checkShipPlacement(n));e.boardInfo.placeShip(n),r.updateShips(o().name,e.boardInfo.board),a(),t()}()}()}()})()})();
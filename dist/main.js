(()=>{"use strict";const e=(e,t)=>({name:e,length:t,hits:new Array(t),hit(e){this.hits[e]||(this.hits[e]="X")},isSunk(){for(let e=0;e<this.hits.length;e++)if(void 0===this.hits[e])return!1;return!0}}),t=()=>{const t=function(){let e=new Array(100);for(let t=0;t<e.length;t++)e[t]={containShip:!1,hasBeenHit:!1};return e}(),n=[];let o=!1;function r(){return n.length}function a(e){switch(e){case 0:return{length:5,name:"Carrier"};case 1:return{length:4,name:"Battleship"};case 2:return{length:3,name:"Cruiser"};case 3:return{length:3,name:"Submarine"};case 4:return{length:2,name:"Destroyer"};default:console.log("this should never be printed")}}return{placeShip:function(i){const{name:c,length:l}=a(r()),u=e(c,l);i=parseFloat(i);for(let e=0;e<l;e++)if(!0===o){let n=10*e;t[i+n].containShip=!0,t[i+n].shipName=c,t[i+n].position=e}else t[i+e].containShip=!0,t[i+e].shipName=c,t[i+e].position=e;n.push(u)},toggleVertical:function(){o=!0!==o},verticalStatus:function(){return o},getNumOfShips:r,getShipInfo:a,receiveAttack:function(e){if(!1===t[e].hasBeenHit){if(t[e].hasBeenHit=!0,!0===t[e].containShip){const r=(o=t[e].shipName,n.filter((e=>e.name===o))[0]);return r.hit(t[e].position),{ship:r,result:!0}}return{ship:void 0,result:!1}}var o},isAllSunk:function(){for(let e=0;e<n.length;e++)if(!1===n[e].isSunk())return!1;return!0},board:t,ships:n}},n=(e,t)=>{function n(e){return!0!==e.hasBeenHit}function o(e){const n=parseFloat(e),{length:o}=t.getShipInfo(t.getNumOfShips());if(t.verticalStatus()){for(let e=0;e<o;e++){const o=10*e+n;if(o>t.board.length-1)return console.log("out of bounds",o),!1;if(!0===t.board[o].containShip)return console.log("ship in path",o),!1}return!0}{let e=(r=n,parseFloat(Math.trunc(r/10)+"9"));for(let r=0;r<o;r++){if(n+r>e)return console.log("wrap error",n+r),!1;if(!0===t.board[n+r].containShip)return console.log("ship in path",n+r),!1}return!0}var r}return"Computer"===e?{name:e,boardInfo:t,checkMove:n,generateMove:function(){return Math.floor(99*Math.random())},checkShipPlacement:o}:{name:e,boardInfo:t,checkMove:n,checkShipPlacement:o}},o=(()=>{const e=document.querySelector(".bulletin"),t=document.querySelector(".container");return{updateShips:function(e,t){for(let n=0;n<t.length;n++)!0===t[n].containShip&&(document.querySelector(`#${e+n}`).style.backgroundColor="rgb(235, 199, 235)")},updateBoardResult:function(e,t){!1===t?(e.textContent="X",e.classList.add("miss")):(e.textContent="O",e.classList.add("hit"))},renderBoard:function(e){let n=document.createElement("div");n.classList="board",n.setAttribute("id",e);for(let t=0;t<=99;t++){let o=document.createElement("div");o.setAttribute("id",`${e+t}`),n.appendChild(o)}t.append(n)},shipDestroyed:function(e,t){for(let n=0;n<t.length;n++)t[n].shipName===e&&(document.querySelector(`#${e+n}`).style.backgroundColor="rgb(235, 199, 235)")},changeBulletMsg:function(t){e.textContent=t},unhideNode:function(e){e.style.transition="opacity 0.5s ease-in",e.style.opacity="1"},hideNode:function(e){e.style.transition="opacity, 0.5s ease-out",e.style.opacity="0"}}})();(()=>{const e=document.getElementById("form"),r=document.querySelector("#name"),a=document.querySelector("#name + button"),i={};function c(){if(5===i.player.boardInfo.getNumOfShips()&&5===i.cpu.boardInfo.getNumOfShips())return console.log("finished placing ships"),void h();!function(){const e=l(),t=document.querySelectorAll(`#${l().name} div`);function n(r){const a=p(r.target.id);e.checkShipPlacement(a)&&(e.boardInfo.placeShip(a),t.forEach((e=>{e.removeEventListener("click",n)})),o.updateShips(l().name,e.boardInfo.board),s(),c())}setTimeout((()=>{"Computer"!==l().name?(o.changeBulletMsg("Please select node to place the ship head."),t.forEach((e=>{e.addEventListener("click",n)}))):(o.changeBulletMsg("Computer is making selection.."),function(){let t;do{Math.floor(2*Math.random())&&e.boardInfo.toggleVertical(),t=e.generateMove()}while(!e.checkShipPlacement(t));e.boardInfo.placeShip(t),s(),c()}())}),2e3)}()}function l(){return i[`${i.currentPlayer}`]}function u(){return"player"===i.currentPlayer?i.cpu:i.player}function s(){"Computer"!==l().name?i.currentPlayer="cpu":i.currentPlayer="player"}function h(){if(i.player.boardInfo.isAllSunk())console.log("made it in here");else if(i.cpu.boardInfo.isAllSunk())console.log("cpu has won");else switch(i.currentPlayer){case"player":!function(){const e=document.querySelectorAll(`#${u().name} div`);function t(n){const o=p(n.target.id),r=u(),a=r.boardInfo.board;if(r.checkMove(a[o]))return e.forEach((e=>e.removeEventListener("click",t))),void d(n.target,o);alert("Cannot select this node, please try again")}e.forEach((e=>{e.addEventListener("click",t)}))}();break;case"cpu":setTimeout((()=>{!function(){let e;const t=u(),n=t.boardInfo.board;do{e=i.cpu.generateMove()}while(!t.checkMove(n[e]));d(document.querySelector(`#${u().name} div[id='${u().name+e}']`),e)}()}),2e3)}}function d(e,t){const{ship:n,result:r}=u().boardInfo.receiveAttack(t);r&&n.isSunk()&&console.log("ship sunk"),o.updateBoardResult(e,r),s(),h()}function p(e){return e.match(/\d+/gm)[0]}setTimeout((()=>{o.changeBulletMsg("Player, please enter your name below: "),o.unhideNode(e)}),2e3),a.addEventListener("click",(function(a){a.preventDefault();const u=r.value;if(r.value="",u){if("Computer"===u)return o.changeBulletMsg("You cannot be a 'Computer' BeepBoop."),void setTimeout((()=>{o.changeBulletMsg("Player, please enter your name below: ")}),2e3);o.changeBulletMsg(`Welcome aboard, ${u}. Making grid..`),o.hideNode(e),setTimeout((()=>{var e;e=`${u}`,i.player=n(e,t()),i.cpu=n("Computer",t()),i.currentPlayer=0===Math.floor(2*Math.random())?"player":"cpu",o.renderBoard(i.player.name),o.renderBoard(i.cpu.name),o.changeBulletMsg(`${l().name} has been randomly chosen to start`),c()}),2e3)}}))})()})();